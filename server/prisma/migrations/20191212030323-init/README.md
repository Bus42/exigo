# Migration `20191212030323-init`

This migration has been generated by Kristóf Poduszló at 12/12/2019, 3:03:23 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "quaint"."User" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "email" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT    ,
  "passwordHash" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "quaint"."Quiz" (
  "author" TEXT NOT NULL   REFERENCES "User"(id) ON DELETE RESTRICT,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "isPrivate" BOOLEAN NOT NULL DEFAULT false  ,
  "timeLimitInMinutes" INTEGER    ,
  "title" TEXT NOT NULL DEFAULT ''  ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "quaint"."QuizItem" (
  "id" TEXT NOT NULL   ,
  "quiz" TEXT    REFERENCES "Quiz"(id) ON DELETE SET NULL,
  "stem" TEXT NOT NULL DEFAULT ''  ,
  "type" TEXT NOT NULL DEFAULT 'MULTIPLE_OPTIONS'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "quaint"."MultipleOptionsQuizItemFragment" (
  "constraints_maxCount" INTEGER    ,
  "constraints_minCount" INTEGER    ,
  "id" TEXT NOT NULL   ,
  "quizItem" TEXT NOT NULL   REFERENCES "QuizItem"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

CREATE TABLE "quaint"."Option" (
  "id" TEXT NOT NULL   ,
  "isSolution" BOOLEAN NOT NULL DEFAULT false  ,
  "multipleOptionsQuizItemFragment" TEXT    REFERENCES "MultipleOptionsQuizItemFragment"(id) ON DELETE SET NULL,
  "text" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "quaint"."NumericQuizItemFragment" (
  "constraints_maxValue" REAL    ,
  "constraints_minValue" REAL    ,
  "id" TEXT NOT NULL   ,
  "precision" REAL    ,
  "quizItem" TEXT NOT NULL   REFERENCES "QuizItem"(id) ON DELETE RESTRICT,
  "solution" REAL NOT NULL DEFAULT 0  ,
  "stepSize" REAL    ,
  PRIMARY KEY ("id")
);

CREATE UNIQUE INDEX "quaint"."User.email" ON "User"("email")

CREATE UNIQUE INDEX "quaint"."MultipleOptionsQuizItemFragment_quizItem" ON "MultipleOptionsQuizItemFragment"("quizItem")

CREATE UNIQUE INDEX "quaint"."NumericQuizItemFragment_quizItem" ON "NumericQuizItemFragment"("quizItem")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20191212030323-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,79 @@
+datasource sqlite {
+  provider = "sqlite"
+  url      = "file:dev.db"
+}
+
+// TODO: Use PostgreSQL in production
+
+generator photon {
+  provider = "photonjs"
+}
+
+model User {
+  id           String   @id @default(cuid())
+  createdAt    DateTime @default(now())
+  email        String   @unique
+  // TODO: Add support for multiple auth providers, e.g. Facebook and Google
+  passwordHash String
+  name         String?
+  quizzes      Quiz[]
+}
+
+model Quiz {
+  id                 String     @id @default(cuid())
+  author             User       @relation(onDelete: CASCADE)
+  createdAt          DateTime   @default(now())
+  updatedAt          DateTime   @updatedAt
+  isPrivate          Boolean    @default(false)
+  title              String
+  timeLimitInMinutes Int?
+  items              QuizItem[]
+}
+
+// TODO: Use union type (https://github.com/prisma/prisma2/issues/253), e.g.:
+// union QuizItem = MultipleOptionsQuizItem | NumericQuizItem
+
+model QuizItem {
+  // TODO: Move these fields to `QuizItemBase`
+  id   String       @id @default(cuid())
+  // TODO: Make required when cascaded deletion is supported
+  quiz Quiz?        @relation(onDelete: CASCADE)
+  type QuizItemType
+  stem String
+
+  fragmentMultipleOptions MultipleOptionsQuizItemFragment?
+  fragmentNumeric         NumericQuizItemFragment?
+}
+
+enum QuizItemType {
+  MULTIPLE_OPTIONS
+  NUMERIC
+}
+
+// TODO: `implements QuizItemBase`
+model MultipleOptionsQuizItemFragment {
+  id                   String   @id @default(cuid())
+  quizItem             QuizItem @relation(references: id, onDelete: CASCADE)
+  options              Option[]
+  constraints_minCount Int?     @default(1)
+  constraints_maxCount Int?     @default(1)
+}
+
+model Option {
+  id         String  @id @default(cuid())
+  // TODO: Add when cascaded deletion is supported
+  // quizItem   QuizItem @relation(onDelete: CASCADE)
+  text       String
+  isSolution Boolean @default(false)
+}
+
+// TODO: `implements QuizItemBase`
+model NumericQuizItemFragment {
+  id                   String   @id @default(cuid())
+  quizItem             QuizItem @relation(references: id, onDelete: CASCADE)
+  solution             Float
+  precision            Float?   @default(0)
+  stepSize             Float?   @default(1)
+  constraints_minValue Float?
+  constraints_maxValue Float?
+}
```
