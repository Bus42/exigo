# Migration `20191124001752-init`

This migration has been generated by Kristóf Poduszló at 11/24/2019, 12:17:52 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."User" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "email" TEXT NOT NULL DEFAULT ''  ,
  "id" TEXT NOT NULL   ,
  "name" TEXT    ,
  "passwordHash" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Quiz" (
  "author" TEXT    REFERENCES "User"(id) ON DELETE SET NULL,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "id" TEXT NOT NULL   ,
  "isPrivate" BOOLEAN NOT NULL DEFAULT false  ,
  "timeLimitInMinutes" INTEGER    ,
  "title" TEXT NOT NULL DEFAULT ''  ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."QuizItem" (
  "id" TEXT NOT NULL   ,
  "quiz" TEXT    REFERENCES "Quiz"(id) ON DELETE SET NULL,
  "stem" TEXT NOT NULL DEFAULT ''  ,
  "type" TEXT NOT NULL DEFAULT 'MULTIPLE_OPTIONS'  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."MultipleOptionsQuizItemFragment" (
  "constraints_maxCount" INTEGER    ,
  "constraints_minCount" INTEGER    ,
  "id" TEXT NOT NULL   ,
  "quizItem" TEXT    REFERENCES "QuizItem"(id) ON DELETE SET NULL,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."Option" (
  "id" TEXT NOT NULL   ,
  "isSolution" BOOLEAN NOT NULL DEFAULT false  ,
  "multipleOptionsQuizItemFragment" TEXT    REFERENCES "MultipleOptionsQuizItemFragment"(id) ON DELETE SET NULL,
  "text" TEXT NOT NULL DEFAULT ''  ,
  PRIMARY KEY ("id")
);

CREATE TABLE "lift"."NumericQuizItemFragment" (
  "constraints_maxValue" REAL    ,
  "constraints_minValue" REAL    ,
  "id" TEXT NOT NULL   ,
  "precision" REAL    ,
  "quizItem" TEXT    REFERENCES "QuizItem"(id) ON DELETE SET NULL,
  "solution" REAL NOT NULL DEFAULT 0  ,
  "stepSize" REAL    ,
  PRIMARY KEY ("id")
);

CREATE UNIQUE INDEX "lift"."User.email" ON "User"("email")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191124001752-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,76 @@
+datasource db {
+  provider = "sqlite"
+  url      = "file:dev.db"
+}
+
+generator photonjs {
+  provider = "photonjs"
+}
+
+model User {
+  id           String   @id @default(cuid())
+  createdAt    DateTime @default(now())
+  email        String   @unique
+  // TODO: Add support for multiple auth providers, e.g. Facebook and Google
+  passwordHash String
+  name         String?
+  quizzes      Quiz[]
+}
+
+model Quiz {
+  id                 String     @id @default(cuid())
+  author             User       @relation(onDelete: CASCADE)
+  createdAt          DateTime   @default(now())
+  updatedAt          DateTime   @updatedAt
+  isPrivate          Boolean    @default(false)
+  title              String
+  timeLimitInMinutes Int?
+  items              QuizItem[]
+}
+
+// TODO: Use union type (https://github.com/prisma/prisma2/issues/253), e.g.:
+// union QuizItem = MultipleOptionsQuizItem | NumericQuizItem
+
+model QuizItem {
+  // TODO: Move these fields to `QuizItemBase`
+  id   String       @id @default(cuid())
+  quiz Quiz         @relation(onDelete: CASCADE)
+  type QuizItemType
+  stem String
+
+  fragmentMultipleOptions MultipleOptionsQuizItemFragment?
+  fragmentNumeric         NumericQuizItemFragment?
+}
+
+enum QuizItemType {
+  MULTIPLE_OPTIONS
+  NUMERIC
+}
+
+// TODO: implements QuizItemBase
+model MultipleOptionsQuizItemFragment {
+  id                   String   @id @default(cuid())
+  quizItem             QuizItem @relation(references: id, onDelete: CASCADE)
+  options              Option[]
+  constraints_minCount Int?     @default(1)
+  constraints_maxCount Int?     @default(1)
+}
+
+model Option {
+  id         String   @id @default(cuid())
+  // TODO: Add when cascaded deletion is supported
+  // quizItem   QuizItem @relation(onDelete: CASCADE)
+  text       String
+  isSolution Boolean  @default(false)
+}
+
+// TODO: implements QuizItemBase
+model NumericQuizItemFragment {
+  id                   String   @id @default(cuid())
+  quizItem             QuizItem @relation(references: id, onDelete: CASCADE)
+  solution             Float
+  precision            Float?   @default(0)
+  stepSize             Float?   @default(1)
+  constraints_minValue Float?
+  constraints_maxValue Float?
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191124001752-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191124001752-init';

const photon = new Photon();

async function main() {
  const result = await photon.users();
  console.dir(result, { depth: null });
}

main();
```
